function control_process(a){$form=jQuery(".layout-controller .slideout-content form");$content=jQuery(".layout-controller .slideout-content form .control-content");jQuery(a).find("extra_vars").each(function(){var a=new Array;jQuery(this).find(">group").each(function(){a[a.length]=this});if(a.length){var b=0;for(i=0;i<a.length;i++){var c=a[i];var d=control_get_vars(c);var e=d[0];var f=d[1];if(jQuery(c).attr("hidden")!="true"){var g=control_get_lang(jQuery(a[i]),"title");var h='<span class="toggle open">open</span><span class="toggle close" style="display:none;">close</span>';var j='<span class="toggle open" style="display:none;">open</span><span class="toggle close" >close</span>';$content.append('<div class="group-title"><span>'+g+'</span><a href="#" class="toggle-group" onclick="return false;">'+(b==0?j:h)+"</a></div>");if(b>0)e.css("display","none");$content.append(e);b++}$form.append(f)}}else{var d=control_get_vars(this);var e=d[0];var f=d[1];$content.append(e);$form.append(f)}});jQuery(a).find("menus").each(function(){jQuery(this).find("menu").each(function(){var a=jQuery(this);var b=a.attr("name");var c=control_get_lang(a,"title");if(menus[b]){var d=menus[b]["menu_srl"];$form.append('<input type="hidden" name="'+b+'" value="'+d+'" />')}})});jQuery(".layout-controller .toggle-group").click(function(){jQuery(this).children().toggle();jQuery(this).parent().next().toggle()})}function control_get_vars(htmlObj){$group_obj=jQuery(htmlObj);var group_hidden=false;var hidden_vars="";if($group_obj.attr("hidden")=="true")group_hidden=true;$table=jQuery("<table></table>");$group_obj.find(">var").each(function(){var $f=jQuery(this);var name=$f.attr("name");var id=$f.attr("id");var type=$f.attr("type");var title=control_get_lang($f,"title");var description=control_get_lang($f,"description");var x_type=$f.attr("x-type");var selector=$f.attr("selector");var attribute=$f.attr("attribute");var _event=$f.attr("event");var script=$f.attr("script");var style=$f.attr("style");var defval="";var hidden=$f.attr("hidden");if(group_hidden)hidden="true";if(layout_info[name])defval=layout_info[name];if(hidden=="true"){hidden_vars+='<input type="hidden" rel="field" name="'+name+'" value="'+defval+'" />'}else{var $val=jQuery("<span></span>");switch(type){case"select":$val=jQuery('<select name="'+name+'"></select>');$f.find("options").each(function(){var a=jQuery(this);var b=control_get_lang(a,"title");var c="";if(a.attr("value")==defval)c=' selected="selected"';var d=jQuery(jQuery.sprintf('<option value="%s"'+c+">%s</option>",a.attr("value"),b));d.appendTo($val)});break;case"text":var attr="";$val=jQuery(jQuery.sprintf('<input name="%s" type="text" value="%s"'+attr+" />",name,defval));if(x_type=="colorpicker"&&selector){$val.ColorPicker({onChange:function(a,b,c){jQuery(selector).css(attribute,"#"+b);$val.val(b)},onSubmit:function(a,b,c,d){jQuery(d).val(b);jQuery(d).ColorPickerHide()}})}break;case"image":if(layout_info[name]){$val=jQuery('<div width="30" height="30"><img src="'+layout_info[name]+'" style="width:30px;" /></div><input name="'+name+'" type="file" value="" style="width:30px;" />')}else{$val=jQuery('<input name="'+name+'" type="file" value="" />')}break;default:$val=jQuery("<span></span>");break}if(id){$val.attr("id",id)}if(_event&&script){$val.bind(_event,function(){eval(script)})}$val.attr("title",description);$tr=jQuery("<tr></tr>");$tr.append("<th>"+title+"</th>");$tr.append(jQuery("<td></td>").append($val));$tr.appendTo($table)}});return[$table,hidden_vars]}function control_reset_settings(a){jQuery("input",a).filter(function(a){return jQuery(this).attr("rel")=="field"}).each(function(){jQuery(this).val("")});jQuery("select",a).each(function(){jQuery(this).empty()});jQuery(a).submit()}function control_get_lang(a,b){var c="";a.find(">"+b).each(function(){var a=jQuery(this);if(a.attr("xml:lang")==lang_type)c=a.text()});return c}(function(a){jQuery(function(a){jQuery.ajax({url:info_path,dataType:"xml",success:function(a){control_process(a);filestyle()}})})})(jQuery)
